<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分库分表策略详解 | 技术文档</title>
    <meta name="description" content="技术学习文档集合">
    <link rel="stylesheet" href="/docs/assets/style.ee6dddf9.css">
    <link rel="modulepreload" href="/docs/assets/app.2a30658a.js">
    <link rel="modulepreload" href="/docs/assets/BACKEND_分库分表策略.md.5c7629e1.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-9c83c81e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-be9c27de></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-be9c27de> Skip to content </a><!--]--><!----><header class="VPNav" data-v-9c83c81e data-v-bd98ce1b><div class="VPNavBar has-sidebar" data-v-bd98ce1b data-v-be850364><div class="container" data-v-be850364><div class="VPNavBarTitle has-sidebar" data-v-be850364 data-v-ef6bdfee><a class="title" href="/docs/" data-v-ef6bdfee><!--[--><!--]--><!----><!--[-->技术文档<!--]--><!--[--><!--]--></a></div><div class="content" data-v-be850364><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-be850364 data-v-4f0f7d90><span id="main-nav-aria-label" class="visually-hidden" data-v-4f0f7d90>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/" data-v-4f0f7d90 data-v-d1df1d79 data-v-cbb71e82><!--[-->首页<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/AI/AIGC.html" data-v-4f0f7d90 data-v-d1df1d79 data-v-cbb71e82><!--[-->文档<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-be850364 data-v-6975dfb0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-6975dfb0 data-v-a11464a8 data-v-9b61e15c><span class="check" data-v-9b61e15c><span class="icon" data-v-9b61e15c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a11464a8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a11464a8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-be850364 data-v-9d62d057 data-v-2aee37ba><!--[--><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-be850364 data-v-af83da42 data-v-0bf5642f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-0bf5642f><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-0bf5642f><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-0bf5642f><div class="VPMenu" data-v-0bf5642f data-v-958884f0><!----><!--[--><!--[--><!----><div class="group" data-v-af83da42><div class="item appearance" data-v-af83da42><p class="label" data-v-af83da42>Appearance</p><div class="appearance-action" data-v-af83da42><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-af83da42 data-v-a11464a8 data-v-9b61e15c><span class="check" data-v-9b61e15c><span class="icon" data-v-9b61e15c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a11464a8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a11464a8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-af83da42><div class="item social-links" data-v-af83da42><div class="VPSocialLinks social-links-list" data-v-af83da42 data-v-2aee37ba><!--[--><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-be850364 data-v-cd76eed2><span class="container" data-v-cd76eed2><span class="top" data-v-cd76eed2></span><span class="middle" data-v-cd76eed2></span><span class="bottom" data-v-cd76eed2></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-9c83c81e data-v-05a75127><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-05a75127><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-05a75127><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-05a75127>Menu</span></button><a class="top-link" href="#" data-v-05a75127> Return to top </a></div><aside class="VPSidebar" data-v-9c83c81e data-v-66069f15><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-66069f15><span class="visually-hidden" id="sidebar-aria-label" data-v-66069f15> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-66069f15><section class="VPSidebarGroup" data-v-66069f15 data-v-7785691c><div class="title" data-v-7785691c><h2 class="title-text" data-v-7785691c>AI</h2><div class="action" data-v-7785691c><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-7785691c><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-7785691c><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-7785691c><!--[--><!--[--><a class="VPLink link link" href="/docs/AI/AIGC.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>AIGC</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/COZE_DIFY.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>COZE & DIFY</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/DashScope_ModelScope.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>DashScope & ModelScope</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/DDG_SERPAPI.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>DDG & SERPAPI</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/FAISS.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>FAISS</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/GPT%E6%9E%B6%E6%9E%84.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>GPT架构</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/LANGCHAIN.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>LANGCHAIN</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/LCEL.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>LCEL</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/MODELS.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>MODELS</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/MOE.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>MOE</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/NLP.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>NLP</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/QIANWEN_VL.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>QIANWEN VL</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/SERPAPI.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>SERPAPI</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/WORD2VEC.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>WORD2VEC</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>大模型应用开发模式</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/%E6%99%BA%E8%83%BD%E4%BD%93%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>智能体系统设计</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/docs/AI/%E7%A8%A0%E5%AF%86%E5%90%91%E9%87%8F-%E7%A8%80%E7%96%8F%E5%90%91%E9%87%8F.html" style="padding-left:0px;" data-v-5686a8aa data-v-cbb71e82><!--[--><span class="link-text" data-v-5686a8aa>稠密向量-稀疏向量</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-9c83c81e data-v-954ad629><div class="VPDoc has-sidebar has-aside" data-v-954ad629 data-v-dc19973f><div class="container" data-v-dc19973f><div class="aside" data-v-dc19973f><div class="aside-curtain" data-v-dc19973f></div><div class="aside-container" data-v-dc19973f><div class="aside-content" data-v-dc19973f><div class="VPDocAside" data-v-dc19973f data-v-63938968><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-63938968 data-v-72b1abc9><div class="content" data-v-72b1abc9><div class="outline-marker" data-v-72b1abc9></div><div class="outline-title" data-v-72b1abc9>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-72b1abc9><span class="visually-hidden" id="doc-outline-aria-label" data-v-72b1abc9> Table of Contents for current page </span><ul class="root" data-v-72b1abc9 data-v-a950ca15><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-63938968></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-dc19973f><div class="content-container" data-v-dc19973f><!--[--><!--]--><main class="main" data-v-dc19973f><div style="position:relative;" class="vp-doc _docs_BACKEND_%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%AD%96%E7%95%A5" data-v-dc19973f><div><h1 id="分库分表策略详解" tabindex="-1">分库分表策略详解 <a class="header-anchor" href="#分库分表策略详解" aria-hidden="true">#</a></h1><h2 id="一、什么是分库分表" tabindex="-1">一、什么是分库分表？ <a class="header-anchor" href="#一、什么是分库分表" aria-hidden="true">#</a></h2><p><strong>分库分表</strong>是数据库水平扩展的核心技术，通过将数据分散到多个数据库或数据表中，解决单库单表数据量过大、性能瓶颈的问题。</p><h3 id="基本概念" tabindex="-1">基本概念 <a class="header-anchor" href="#基本概念" aria-hidden="true">#</a></h3><table><thead><tr><th style="text-align:left;">概念</th><th style="text-align:left;">说明</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>分库</strong></td><td style="text-align:left;">将数据分散到多个数据库中</td><td style="text-align:left;">用户表按用户ID取模，分散到 <code>user_db_0</code>、<code>user_db_1</code>、<code>user_db_2</code></td></tr><tr><td style="text-align:left;"><strong>分表</strong></td><td style="text-align:left;">将数据分散到同一数据库的多个表中</td><td style="text-align:left;">订单表按月份拆分：<code>order_202401</code>、<code>order_202402</code>、<code>order_202403</code></td></tr><tr><td style="text-align:left;"><strong>分库分表</strong></td><td style="text-align:left;">同时进行分库和分表</td><td style="text-align:left;">先分库，每个库内再分表</td></tr></tbody></table><hr><h2 id="二、为什么需要分库分表" tabindex="-1">二、为什么需要分库分表？ <a class="header-anchor" href="#二、为什么需要分库分表" aria-hidden="true">#</a></h2><h3 id="_1-单库单表的瓶颈" tabindex="-1">1. 单库单表的瓶颈 <a class="header-anchor" href="#_1-单库单表的瓶颈" aria-hidden="true">#</a></h3><h4 id="性能瓶颈" tabindex="-1">性能瓶颈 <a class="header-anchor" href="#性能瓶颈" aria-hidden="true">#</a></h4><ul><li><strong>数据量过大</strong>：单表数据超过千万级别，查询性能急剧下降</li><li><strong>索引效率降低</strong>：B+树索引深度增加，查询需要更多磁盘IO</li><li><strong>锁竞争加剧</strong>：高并发下，表级锁或行级锁竞争激烈</li><li><strong>连接数限制</strong>：单库连接数有限，无法支撑高并发</li></ul><h4 id="容量瓶颈" tabindex="-1">容量瓶颈 <a class="header-anchor" href="#容量瓶颈" aria-hidden="true">#</a></h4><ul><li><strong>存储空间</strong>：单库存储容量有限</li><li><strong>备份恢复</strong>：数据量过大，备份和恢复时间过长</li><li><strong>运维困难</strong>：DDL操作（如添加索引）耗时过长，影响业务</li></ul><h3 id="_2-何时考虑分库分表" tabindex="-1">2. 何时考虑分库分表？ <a class="header-anchor" href="#_2-何时考虑分库分表" aria-hidden="true">#</a></h3><p><strong>判断标准</strong>：</p><ul><li>✅ 单表数据量超过 <strong>500万-1000万</strong> 行</li><li>✅ 数据库QPS超过 <strong>5000-10000</strong></li><li>✅ 单表文件大小超过 <strong>10GB</strong></li><li>✅ 查询响应时间明显变慢（&gt;1秒）</li><li>✅ 频繁出现慢查询</li></ul><p><strong>注意</strong>：不要过早优化！优先考虑：</p><ol><li>优化SQL和索引</li><li>读写分离</li><li>缓存优化</li><li>数据库参数调优</li></ol><hr><h2 id="三、分库分表策略" tabindex="-1">三、分库分表策略 <a class="header-anchor" href="#三、分库分表策略" aria-hidden="true">#</a></h2><h3 id="_1-水平分表-horizontal-sharding" tabindex="-1">1. 水平分表（Horizontal Sharding） <a class="header-anchor" href="#_1-水平分表-horizontal-sharding" aria-hidden="true">#</a></h3><p>将同一张表的数据按<strong>行</strong>拆分到多个表中，表结构相同。</p><h4 id="策略分类" tabindex="-1">策略分类 <a class="header-anchor" href="#策略分类" aria-hidden="true">#</a></h4><h5 id="_1-范围分片-range-sharding" tabindex="-1">① 范围分片（Range Sharding） <a class="header-anchor" href="#_1-范围分片-range-sharding" aria-hidden="true">#</a></h5><p><strong>原理</strong>：按数据范围划分</p><p><strong>示例</strong>：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">-- 按用户ID范围分表</span></span>
<span class="line"><span style="color:#A6ACCD;">user_0: </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">user_id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000000</span></span>
<span class="line"><span style="color:#A6ACCD;">user_1: </span><span style="color:#F78C6C;">1000000</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">user_id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2000000</span></span>
<span class="line"><span style="color:#A6ACCD;">user_2: </span><span style="color:#F78C6C;">2000000</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">user_id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000000</span></span>
<span class="line"></span></code></pre></div><p><strong>优点</strong>：</p><ul><li>实现简单，易于理解</li><li>范围查询效率高</li><li>数据迁移方便</li></ul><p><strong>缺点</strong>：</p><ul><li>容易产生数据倾斜（热点数据集中）</li><li>需要提前规划范围</li><li>扩容需要迁移数据</li></ul><h5 id="_2-哈希分片-hash-sharding" tabindex="-1">② 哈希分片（Hash Sharding） <a class="header-anchor" href="#_2-哈希分片-hash-sharding" aria-hidden="true">#</a></h5><p><strong>原理</strong>：对分片键进行哈希运算，取模分配到不同表</p><p><strong>示例</strong>：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;"># 按用户ID取模分表</span></span>
<span class="line"><span style="color:#A6ACCD;">shard_num </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> user_id </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#A6ACCD;">table_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;user_</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">shard_num</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 用户ID=1001 -&gt; 1001 % 4 = 1 -&gt; user_1</span></span>
<span class="line"><span style="color:#676E95;"># 用户ID=1002 -&gt; 1002 % 4 = 2 -&gt; user_2</span></span>
<span class="line"></span></code></pre></div><p><strong>优点</strong>：</p><ul><li>数据分布均匀，避免热点</li><li>实现简单，查询路由明确</li><li>适合高并发场景</li></ul><p><strong>缺点</strong>：</p><ul><li>扩容困难（需要重新哈希）</li><li>范围查询需要跨表</li><li>无法按业务逻辑分片</li></ul><h5 id="_3-一致性哈希-consistent-hashing" tabindex="-1">③ 一致性哈希（Consistent Hashing） <a class="header-anchor" href="#_3-一致性哈希-consistent-hashing" aria-hidden="true">#</a></h5><p><strong>原理</strong>：将哈希值空间组织成虚拟环，节点和数据都映射到环上</p><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">哈希环: 0 ----1000----2000----3000----4000----0</span></span>
<span class="line"><span style="color:#A6ACCD;">节点:   Node1  Node2  Node3  Node4</span></span>
<span class="line"><span style="color:#A6ACCD;">数据:   key1-&gt;Node2, key2-&gt;Node3, key3-&gt;Node4</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>优点</strong>：</p><ul><li>扩容时只需迁移少量数据</li><li>节点增减影响范围小</li><li>适合动态扩容场景</li></ul><p><strong>缺点</strong>：</p><ul><li>实现复杂</li><li>可能出现数据倾斜（虚拟节点解决）</li></ul><h5 id="_4-目录分片-directory-sharding" tabindex="-1">④ 目录分片（Directory Sharding） <a class="header-anchor" href="#_4-目录分片-directory-sharding" aria-hidden="true">#</a></h5><p><strong>原理</strong>：维护一个分片映射表，记录数据到分片的映射关系</p><p><strong>示例</strong>：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">-- 分片映射表</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> shard_mapping (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">user_id</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">BIGINT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">PRIMARY</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">KEY</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    shard_id </span><span style="color:#F78C6C;">INT</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    table_name </span><span style="color:#F78C6C;">VARCHAR</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 查询时先查映射表</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shard_id, table_name </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> shard_mapping </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">user_id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1001</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>优点</strong>：</p><ul><li>灵活，支持复杂分片规则</li><li>易于调整分片策略</li><li>支持非均匀分片</li></ul><p><strong>缺点</strong>：</p><ul><li>需要额外维护映射表</li><li>映射表可能成为瓶颈</li><li>查询需要两次访问</li></ul><h3 id="_2-垂直分表-vertical-sharding" tabindex="-1">2. 垂直分表（Vertical Sharding） <a class="header-anchor" href="#_2-垂直分表-vertical-sharding" aria-hidden="true">#</a></h3><p>将同一张表按<strong>列</strong>拆分，将不常用或大字段分离到扩展表。</p><p><strong>示例</strong>：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">-- 主表：存储常用字段</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> user (</span></span>
<span class="line"><span style="color:#A6ACCD;">    id </span><span style="color:#F78C6C;">BIGINT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">PRIMARY</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">KEY</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    username </span><span style="color:#F78C6C;">VARCHAR</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    email </span><span style="color:#F78C6C;">VARCHAR</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    created_at </span><span style="color:#F78C6C;">TIMESTAMP</span></span>
<span class="line"><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 扩展表：存储不常用字段</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> user_ext (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">user_id</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">BIGINT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">PRIMARY</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">KEY</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    bio </span><span style="color:#F78C6C;">TEXT</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    avatar_url </span><span style="color:#F78C6C;">VARCHAR</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">255</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    settings </span><span style="color:#F78C6C;">JSON</span></span>
<span class="line"><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span></code></pre></div><p><strong>优点</strong>：</p><ul><li>减少单表字段数，提升查询效率</li><li>大字段分离，减少IO</li><li>可按访问频率优化</li></ul><p><strong>缺点</strong>：</p><ul><li>需要JOIN查询</li><li>事务处理复杂</li><li>数据一致性需要保证</li></ul><h3 id="_3-垂直分库" tabindex="-1">3. 垂直分库 <a class="header-anchor" href="#_3-垂直分库" aria-hidden="true">#</a></h3><p>按业务模块将不同表拆分到不同数据库。</p><p><strong>示例</strong>：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">user_db:    用户相关表（user, user_profile, user_settings）</span></span>
<span class="line"><span style="color:#A6ACCD;">order_db:   订单相关表（order, order_item, payment）</span></span>
<span class="line"><span style="color:#A6ACCD;">product_db: 商品相关表（product, category, inventory）</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>优点</strong>：</p><ul><li>业务解耦，便于独立扩展</li><li>降低单库压力</li><li>便于团队分工</li></ul><p><strong>缺点</strong>：</p><ul><li>跨库事务复杂（需要分布式事务）</li><li>跨库JOIN困难</li><li>数据一致性保证困难</li></ul><hr><h2 id="四、分片键-sharding-key-选择" tabindex="-1">四、分片键（Sharding Key）选择 <a class="header-anchor" href="#四、分片键-sharding-key-选择" aria-hidden="true">#</a></h2><h3 id="_1-分片键的重要性" tabindex="-1">1. 分片键的重要性 <a class="header-anchor" href="#_1-分片键的重要性" aria-hidden="true">#</a></h3><p><strong>分片键</strong>是决定数据分布的关键字段，选择不当会导致：</p><ul><li>数据倾斜（热点问题）</li><li>跨分片查询增多</li><li>扩容困难</li></ul><h3 id="_2-选择原则" tabindex="-1">2. 选择原则 <a class="header-anchor" href="#_2-选择原则" aria-hidden="true">#</a></h3><h4 id="_1-高基数-cardinality" tabindex="-1">① 高基数（Cardinality） <a class="header-anchor" href="#_1-高基数-cardinality" aria-hidden="true">#</a></h4><p>分片键的值应该尽可能分散，避免集中在少数几个值。</p><p><strong>好的选择</strong>：</p><ul><li>用户ID（每个用户唯一）</li><li>订单ID（每个订单唯一）</li><li>UUID（全局唯一）</li></ul><p><strong>不好的选择</strong>：</p><ul><li>性别（只有2-3个值）</li><li>状态（只有几个状态值）</li><li>地区（值有限）</li></ul><h4 id="_2-业务相关性" tabindex="-1">② 业务相关性 <a class="header-anchor" href="#_2-业务相关性" aria-hidden="true">#</a></h4><p>分片键应该与业务查询模式匹配，减少跨分片查询。</p><p><strong>示例</strong>：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">-- 如果经常按用户ID查询订单</span></span>
<span class="line"><span style="color:#676E95;">-- 分片键选择：user_id（而不是order_id）</span></span>
<span class="line"><span style="color:#676E95;">-- 这样同一用户的订单在同一分片</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> order </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">user_id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1001</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="_3-避免热点" tabindex="-1">③ 避免热点 <a class="header-anchor" href="#_3-避免热点" aria-hidden="true">#</a></h4><p>避免选择会导致数据集中在少数分片的字段。</p><p><strong>问题示例</strong>：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">-- 按创建时间分片，新数据都集中在最新分片</span></span>
<span class="line"><span style="color:#A6ACCD;">order_202412: 大量新订单（热点）</span></span>
<span class="line"><span style="color:#A6ACCD;">order_202411: 少量订单</span></span>
<span class="line"><span style="color:#A6ACCD;">order_202410: 更少订单</span></span>
<span class="line"></span></code></pre></div><p><strong>解决方案</strong>：</p><ul><li>使用组合分片键：<code>(user_id, create_time)</code></li><li>使用哈希分片而非范围分片</li></ul><h3 id="_3-常见分片键选择" tabindex="-1">3. 常见分片键选择 <a class="header-anchor" href="#_3-常见分片键选择" aria-hidden="true">#</a></h3><table><thead><tr><th style="text-align:left;">业务场景</th><th style="text-align:left;">推荐分片键</th><th style="text-align:left;">原因</th></tr></thead><tbody><tr><td style="text-align:left;">用户表</td><td style="text-align:left;"><code>user_id</code></td><td style="text-align:left;">高基数，查询模式匹配</td></tr><tr><td style="text-align:left;">订单表</td><td style="text-align:left;"><code>user_id</code></td><td style="text-align:left;">按用户查询多，避免跨分片</td></tr><tr><td style="text-align:left;">订单表</td><td style="text-align:left;"><code>order_id</code></td><td style="text-align:left;">如果按订单ID查询多</td></tr><tr><td style="text-align:left;">商品表</td><td style="text-align:left;"><code>category_id</code> + <code>product_id</code></td><td style="text-align:left;">组合键，按分类查询</td></tr><tr><td style="text-align:left;">日志表</td><td style="text-align:left;"><code>user_id</code> + <code>date</code></td><td style="text-align:left;">组合键，按用户和时间查询</td></tr></tbody></table></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-dc19973f data-v-5440e431><!----><div class="prev-next" data-v-5440e431><div class="pager" data-v-5440e431><!----></div><div class="pager" data-v-5440e431><a class="pager-link next" href="/docs/AI/AIGC.html" data-v-5440e431><span class="desc" data-v-5440e431>Next page</span><span class="title" data-v-5440e431>AIGC</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-9c83c81e data-v-0bba5d65><div class="container" data-v-0bba5d65><p class="message" data-v-0bba5d65>技术文档集合</p><p class="copyright" data-v-0bba5d65>Copyright © 2024</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"ai_aigc.md\":\"7e96d0af\",\"ai_coze_dify.md\":\"8e8b8ed4\",\"ai_ddg_serpapi.md\":\"2faa92fe\",\"ai_dashscope_modelscope.md\":\"536ed077\",\"ai_faiss.md\":\"b1d3e12a\",\"ai_gpt架构.md\":\"c1ee6976\",\"ai_langchain.md\":\"722db8a6\",\"ai_lcel.md\":\"2a7516e9\",\"ai_models.md\":\"d396cbb7\",\"ai_moe.md\":\"8f51fc73\",\"ai_nlp.md\":\"466e755d\",\"ai_qianwen_vl.md\":\"55d4d78c\",\"ai_rag.md\":\"37f05a5e\",\"ai_serpapi.md\":\"88f17047\",\"ai_transformer.md\":\"e49385c8\",\"ai_word2vec.md\":\"2ebd9b15\",\"ai_大模型应用开发模式.md\":\"545c1cd6\",\"ai_智能体系统设计.md\":\"fae1cbb6\",\"ai_稠密向量-稀疏向量.md\":\"493c7f5a\",\"backend_acid.md\":\"5ceb59fb\",\"backend_acid_my.md\":\"96a2ed5b\",\"backend_python gil 影响与解决方案.md\":\"b1d03e54\",\"backend_restfulapi.md\":\"3d93312e\",\"backend_database_basis.md\":\"ff20ecf4\",\"backend_database_character-set.md\":\"3a3a8b59\",\"backend_database_nosql.md\":\"6ea14bb8\",\"backend_database_redis_redis-questions-01.md\":\"300014a6\",\"backend_database_redis_redis-questions-02.md\":\"9171b6b8\",\"backend_database_redis_数据结构.md\":\"a8ac6131\",\"backend_database_sql_sql-syntax-summary.md\":\"a30a555d\",\"backend_docker_docker-in-action.md\":\"58a063c6\",\"backend_docker_docker-intro.md\":\"f01420c3\",\"backend_index.md\":\"1aaf6918\",\"backend_分库分表策略.md\":\"5c7629e1\",\"backend_协程.md\":\"255322a8\",\"backend_死锁.md\":\"779b1f6d\",\"backend_进程-线程-协程.md\":\"819bf76b\",\"index.md\":\"b4771d2a\"}")</script>
    <script type="module" async src="/docs/assets/app.2a30658a.js"></script>
    
  </body>
</html>